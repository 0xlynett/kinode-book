# Kernel API

The kernel accepts  only a few types of requests (TODO: which?). Generally, userspace applications will not have the cabaility to message the kernel. 

```rust
pub enum KernelCommand {
    Booted,
    InitializeProcess {
        id: ProcessId,
        wasm_bytes_handle: u128,
        on_panic: OnPanic,
        initial_capabilities: HashSet<SignedCapability>,
        public: bool,
    },
    RunProcess(ProcessId),
    KillProcess(ProcessId),
    Shutdown,
}
```

All `KernelCommand`s are sent in the IPC field as this struct serialized to JSON text bytes using `serde_json`.

## `Booted`

Purely for internal use within the kernel (TODO: does this not require any explanation at all then?).

## `InitializeProcess`

The first command used to start a new process. Generally available to apps via the `spawn()` function in the WIT interface. The `wasm_bytes_handle` is a pointer generated by the [filesystem](filesystem.md) API -- it should be a valid .wasm file compiled using the Uqbar tooling. The `on_panic` field is an enum that specifies what to do if the process panics. The `initial_capabilities` field is a set of capabilities that the process will have access to -- note that the capabilities are signed by this kernel. The `public` field specifies whether the process should be visible to other processes *without* needing to grant a messaging capability.

`InitializeProcess` must be sent with a payload. The payload must be the same .wasm file, in raw bytes, that the `wasm_bytes_handle` points to.

This will *not* cause the process to begin running. To do that, send a `RunProcess` command after a successful `InitializeProcess` command.

## `RunProcess`

Takes a process ID and tells kernel to call the `init` function. The process must have first been Initialized.

## `KillProcess`

Takes a process ID and kills it. This is a dangerous operation as messages queued for the process will be lost.

## `RebootProcess`

Purely for internal use within the kernel.

## `Shutdown`

Send to the kernel in order to gracefully shut down the system. The runtime must perform this request before exiting in order to see that all processes are properly cleaned up.